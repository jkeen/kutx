/*! audio5 2013-09-02 */
!function(a,b,c){"use strict";"undefined"!=typeof module&&module.exports?module.exports=c(b,a):"function"==typeof define&&define.amd?define(function(){return c(b,a)}):a[b]=c(b,a)}(window,"Audio5js",function(a,b){"use strict";function c(a){this.message=a}function d(a){var b,c={};for(b in a)c[b]="object"==typeof a[b]?d(a[b]):a[b];return c}var e=b.ActiveXObject;c.prototype=new Error;var f=function(a,b){var c,e=d(b);for(c in e)e.hasOwnProperty(c)&&(a[c]=e[c]);return a},g=function(a,b){return f(a.prototype,b)},h={on:function(a,b,c){this.subscribe(a,b,c,!1)},one:function(a,b,c){this.subscribe(a,b,c,!0)},off:function(a,b){if(void 0!==this.channels[a]){var c,d;for(c=0,d=this.channels[a].length;d>c;c++){var e=this.channels[a][c].fn;if(e===b){this.channels[a].splice(c,1);break}}}},subscribe:function(a,b,c,d){void 0===this.channels&&(this.channels={}),this.channels[a]=this.channels[a]||[],this.channels[a].push({fn:b,ctx:c,once:d||!1})},trigger:function(a){if(this.channels&&this.channels.hasOwnProperty(a)){for(var b=Array.prototype.slice.call(arguments,1),c=[];this.channels[a].length>0;){var d=this.channels[a].shift();"function"==typeof d.fn&&d.fn.apply(d.ctx,b),d.once||c.push(d)}this.channels[a]=c}}},i={flash_embed_code:function(){var b,c='<param name="movie" value="$2?playerInstance=window.'+a+"_flash.instances['$1']&datetime=$3\"/>"+'<param name="wmode" value="transparent"/>'+'<param name="allowscriptaccess" value="always" />'+"</object>";return b=e?'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" id="$1">':'<object type="application/x-shockwave-flash" data="$2?playerInstance=window.'+a+'_flash.instances[\'$1\']&datetime=$3" width="1" height="1" id="$1" >',b+c}(),can_play:function(a){var b,c=document.createElement("audio");switch(a){case"mp3":b='audio/mpeg; codecs="mp3"';break;case"vorbis":b='audio/ogg; codecs="vorbis"';break;case"opus":b='audio/ogg; codecs="opus"';break;case"webm":b='audio/webm; codecs="vorbis"';break;case"mp4":b='audio/mp4; codecs="mp4a.40.5"';break;case"wav":b='audio/wav; codecs="1"'}if(void 0===b)throw new Error("Unspecified Audio Mime Type");return!!c.canPlayType&&""!==c.canPlayType(b)},has_flash:function(){var a=!1;if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"])a=!0;else if(navigator.mimeTypes&&navigator.mimeTypes.length){var b=navigator.mimeTypes["application/x-shockwave-flash"];a=b&&b.enabledPlugin}else try{var c=new e("ShockwaveFlash.ShockwaveFlash");a="object"==typeof c}catch(d){}return a}(),embedFlash:function(c,d){var e=document.createElement("div");if(e.style.position="absolute",e.style.width="1px",e.style.height="1px",e.style.top="1px",document.body.appendChild(e),"object"==typeof b.swfobject){var f={playerInstance:"window."+a+'_flash.instances["'+d+'"]'},g={allowscriptaccess:"always",wmode:"transparent"};e.innerHTML='<div id="'+d+'"></div>',swfobject.embedSWF(c+"?ts="+((new Date).getTime()+Math.random()),d,"1","1","9.0.0",null,f,g)}else{var h=this.flash_embed_code.replace(/\$1/g,d);h=h.replace(/\$2/g,c),h=h.replace(/\$3/g,(new Date).getTime()+Math.random()),e.innerHTML=h}return document.getElementById(d)},formatTime:function(a){var b,c=parseInt(a/3600,10)%24,d=parseInt(a/60,10)%60,e=parseInt(a%60,10),f=(10>d?"0"+d:d)+":"+(10>e?"0"+e:e);return b=c>0?(10>c?"0"+c:c)+":"+f:f}};i.use_flash=i.can_play("mp3");var j,k,l,m={waiting:!1,playing:!1,vol:1,duration:0,position:0,load_percent:0,seekable:null,ready:null},n=b[a+"_flash"]=b[a+"_flash"]||{instances:{},count:0};k=function(){if(i.use_flash&&!i.has_flash)throw new Error("Flash Plugin Missing")},k.prototype={init:function(b){n.count+=1,this.id=a+n.count,n.instances[this.id]=this,this.embed(b)},embed:function(a){i.embedFlash(a,this.id)},eiReady:function(){this.audio=document.getElementById(this.id),this.trigger("ready")},eiLoadStart:function(){this.trigger("loadstart")},eiLoadedMetadata:function(){this.trigger("loadedmetadata")},eiCanPlay:function(){this.trigger("canplay")},eiTimeUpdate:function(a,b,c){this.position=a,this.duration=b,this.seekable=c,this.trigger("timeupdate",a,this.seekable?b:null)},eiProgress:function(a){this.load_percent=a,this.trigger("progress",a)},eiLoadError:function(a){this.trigger("error",a)},eiPlay:function(){this.playing=!0,this.trigger("play")},eiPause:function(){this.playing=!1,this.trigger("pause")},eiEnded:function(){this.playing=!1,this.trigger("ended")},eiSeeking:function(){this.trigger("seeking")},eiSeeked:function(){this.trigger("seeked")},reset:function(){this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(a){this.reset(),this.audio.load(a)},play:function(){this.audio.pplay()},pause:function(){this.audio.ppause()},volume:function(a){return void 0===a||isNaN(parseInt(a,10))?this.vol:(this.audio.setVolume(a),this.vol=a,void 0)},seek:function(a){try{this.audio.seekTo(a),this.position=a}catch(b){}}},g(k,h),g(k,m),l=function(){},l.prototype={init:function(){this.trigger("ready")},createAudio:function(){this.audio=new Audio,this.audio.autoplay=!1,this.audio.preload="auto",this.audio.autobuffer=!0,this.bindEvents()},destroyAudio:function(){this.audio&&(this.unbindEvents(),delete this.audio)},bindEvents:function(){this.audio.addEventListener("loadstart",this.onLoadStart.bind(this)),this.audio.addEventListener("canplay",this.onLoad.bind(this)),this.audio.addEventListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.audio.addEventListener("play",this.onPlay.bind(this)),this.audio.addEventListener("waiting",this.onWaiting.bind(this)),this.audio.addEventListener("playing",this.onPlaying.bind(this)),this.audio.addEventListener("pause",this.onPause.bind(this)),this.audio.addEventListener("ended",this.onEnded.bind(this)),this.audio.addEventListener("error",this.onError.bind(this)),this.audio.addEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.audio.addEventListener("seeking",this.onSeeking.bind(this)),this.audio.addEventListener("seeked",this.onSeeked.bind(this))},unbindEvents:function(){this.audio.removeEventListener("loadstart",this.onLoadStart.bind(this)),this.audio.removeEventListener("canplay",this.onLoad.bind(this)),this.audio.removeEventListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.audio.removeEventListener("play",this.onPlay.bind(this)),this.audio.removeEventListener("waiting",this.onWaiting.bind(this)),this.audio.removeEventListener("playing",this.onPlaying.bind(this)),this.audio.removeEventListener("pause",this.onPause.bind(this)),this.audio.removeEventListener("ended",this.onEnded.bind(this)),this.audio.removeEventListener("error",this.onError.bind(this)),this.audio.removeEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.audio.removeEventListener("seeking",this.onSeeking.bind(this)),this.audio.removeEventListener("seeked",this.onSeeked.bind(this))},onLoadStart:function(){this.trigger("loadstart")},onLoad:function(){this.seekable=this.audio.seekable&&this.audio.seekable.length>0,this.seekable&&(this.timer=setInterval(this.onProgress.bind(this),250)),this.trigger("canplay")},onLoadedMetadata:function(){this.trigger("loadedmetadata")},onPlay:function(){this.trigger("play")},onWaiting:function(){this.waiting=!0,this.trigger("waiting")},onPlaying:function(){this.waiting=!1,this.playing=!0,this.trigger("playing")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onTimeUpdate:function(){null!==this.audio.buffered&&this.audio.buffered.length&&this.playing&&(this.position=this.audio.currentTime,this.duration=1/0===this.audio.duration?null:this.audio.duration,this.trigger("timeupdate",this.position,this.duration))},onProgress:function(){null!==this.audio.buffered&&this.audio.buffered.length&&(this.load_percent=parseInt(100*(this.audio.buffered.end(this.audio.buffered.length-1)/this.audio.duration),10),this.trigger("progress",this.load_percent),this.load_percent>=100&&this.clearLoadProgress())},onError:function(a){this.trigger("error",a)},onSeeking:function(){this.trigger("seeking")},onSeeked:function(){this.trigger("seeked")},clearLoadProgress:function(){void 0!==this.timer&&(clearInterval(this.timer),delete this.timer)},reset:function(){this.clearLoadProgress(),this.waiting=!1,this.playing=!1,this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(a){this.reset(),this.destroyAudio(),this.createAudio(),this.audio.setAttribute("src",a),this.audio.load()},play:function(){this.audio.play()},pause:function(){this.audio.pause()},volume:function(a){if(void 0===a||isNaN(parseInt(a,10)))return this.vol;var b=0>a?0:Math.min(1,a);this.audio.volume=b,this.vol=b},seek:function(a){var b=this.playing;this.position=a,this.audio.currentTime=a,b?this.play():null!==this.audio.buffered&&this.audio.buffered.length&&this.trigger("timeupdate",this.position,this.duration)}},g(l,h),g(l,m);var o={swf_path:"/swf/audiojs.swf",throw_errors:!0,format_time:!0,codecs:["mp3"]};return j=function(a){a=a||{};var b;for(b in o)o.hasOwnProperty(b)&&!a.hasOwnProperty(b)&&(a[b]=o[b]);this.init(a)},j.can_play=function(a){return i.can_play(a)},j.prototype={init:function(a){this.ready=!1,this.settings=a,this.audio=this.getPlayer(),this.bindAudioEvents(),this.settings.use_flash?this.audio.init(a.swf_path):this.audio.init()},getPlayer:function(){var a,b,c;for(a=0,b=this.settings.codecs.length;b>a;a++){var d=this.settings.codecs[a];if(j.can_play(d)){c=new l,this.settings.use_flash=!1,this.settings.player={engine:"html",codec:d};break}}return void 0===c&&(this.settings.use_flash=!j.can_play("mp3"),c=this.settings.use_flash?new k:new l,this.settings.player={engine:this.settings.use_flash?"flash":"html",codec:"mp3"}),c},bindAudioEvents:function(){this.audio.on("ready",this.onReady,this),this.audio.on("loadstart",this.onLoadStart,this),this.audio.on("loadedmetadata",this.onLoadedMetadata,this),this.audio.on("play",this.onPlay,this),this.audio.on("waiting",this.onWaiting,this),this.audio.on("playing",this.onPlaying,this),this.audio.on("pause",this.onPause,this),this.audio.on("ended",this.onEnded,this),this.audio.on("canplay",this.onCanPlay,this),this.audio.on("timeupdate",this.onTimeUpdate,this),this.audio.on("progress",this.onProgress,this),this.audio.on("error",this.onError,this),this.audio.on("seeking",this.onSeeking,this),this.audio.on("seeked",this.onSeeked,this)},load:function(a){var b=function(a){this.audio.load(a),this.trigger("load")}.bind(this,a);this.ready?b():this.on("ready",b)},play:function(){this.playing||this.audio.play()},pause:function(){this.playing&&this.audio.pause()},playPause:function(){this[this.playing?"pause":"play"]()},volume:function(a){return void 0===a||isNaN(parseInt(a,10))?this.vol:(this.audio.volume(a),this.vol=a,void 0)},seek:function(a){this.audio.seek(a),this.position=a},onReady:function(){this.ready=!0,"function"==typeof this.settings.ready&&this.settings.ready.call(this,this.settings.player),this.trigger("ready")},onLoadStart:function(){this.trigger("loadstart")},onLoadedMetadata:function(){this.trigger("loadedmetadata")},onPlay:function(){this.trigger("play")},onWaiting:function(){this.waiting=!0,this.trigger("waiting")},onPlaying:function(){this.waiting=!1,this.playing=!0,this.trigger("playing")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onError:function(){var a=new c("Audio Error. Failed to Load Audio");if(this.settings.throw_errors)throw a;this.trigger("error",a)},onCanPlay:function(){this.trigger("canplay")},onSeeking:function(){this.trigger("seeking")},onSeeked:function(){this.trigger("seeked")},onTimeUpdate:function(a,b){this.position=this.settings.format_time?i.formatTime(a):a,this.duration!==b&&(this.duration=this.settings.format_time&&null!==b?i.formatTime(b):b),this.trigger("timeupdate",this.position,this.duration)},onProgress:function(a){this.load_percent=a,this.trigger("progress",a)}},g(j,h),g(j,m),j});